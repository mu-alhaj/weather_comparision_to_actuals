#! /bin/bash

city=Casablanca
tz='Morocco/Casablanca'

#Obtain the weather info and save it to a text file.
curl wttr.in/$city?T > weather_report.txt



#		Here is how the weather report looks like.



#Weather report: Casablanca
#
#                Overcast
#       .--.     +24(26) °C     
#    .-(    ).   ↘ 5 km/h       
#   (___.__)__)  5 km           
#                0.0 mm         
#                                                       ┌─────────────┐                                                       
#┌──────────────────────────────┬───────────────────────┤  Fri 15 Aug ├───────────────────────┬──────────────────────────────┐
#│            Morning           │             Noon      └──────┬──────┘     Evening           │             Night            │
#├──────────────────────────────┼──────────────────────────────┼──────────────────────────────┼──────────────────────────────┤
#│     \   /     Sunny          │     \   /     Sunny          │     \   /     Sunny          │    \  /       Partly Cloudy  │
#│      .-.      +26(28) °C     │      .-.      +28(30) °C     │      .-.      +26(28) °C     │  _ /"".-.     +25(26) °C     │
#│   ― (   ) ―   ↘ 8-9 km/h     │   ― (   ) ―   ↘ 13-15 km/h   │   ― (   ) ―   ↘ 11-14 km/h   │    \_(   ).   ↓ 8-15 km/h    │
#│      `-’      10 km          │      `-’      10 km          │      `-’      10 km          │    /(___(__)  10 km          │
#│     /   \     0.0 mm | 0%    │     /   \     0.0 mm | 0%    │     /   \     0.0 mm | 0%    │               0.0 mm | 0%    │
#└──────────────────────────────┴──────────────────────────────┴──────────────────────────────┴──────────────────────────────┘
#                                                       ┌─────────────┐                                                       
#┌──────────────────────────────┬───────────────────────┤  Sat 16 Aug ├───────────────────────┬──────────────────────────────┐
#│            Morning           │             Noon      └──────┬──────┘     Evening           │             Night            │
#├──────────────────────────────┼──────────────────────────────┼──────────────────────────────┼──────────────────────────────┤
#│     \   /     Sunny          │     \   /     Sunny          │     \   /     Sunny          │    \  /       Partly Cloudy  │
#│      .-.      +26(28) °C     │      .-.      +29(31) °C     │      .-.      +27(30) °C     │  _ /"".-.     +26(28) °C     │
#│   ― (   ) ―   ↘ 10-16 km/h   │   ― (   ) ―   ↘ 10-14 km/h   │   ― (   ) ―   ↓ 11-16 km/h   │    \_(   ).   ↖ 9-19 km/h    │
#│      `-’      10 km          │      `-’      10 km          │      `-’      10 km          │    /(___(__)  10 km          │
#│     /   \     0.0 mm | 0%    │     /   \     0.0 mm | 0%    │     /   \     0.0 mm | 0%    │               0.0 mm | 0%    │
#└──────────────────────────────┴──────────────────────────────┴──────────────────────────────┴──────────────────────────────┘
#                                                       ┌─────────────┐                                                       
#┌──────────────────────────────┬───────────────────────┤  Sun 17 Aug ├───────────────────────┬──────────────────────────────┐
#│            Morning           │             Noon      └──────┬──────┘     Evening           │             Night            │
#├──────────────────────────────┼──────────────────────────────┼──────────────────────────────┼──────────────────────────────┤
#│     \   /     Sunny          │     \   /     Sunny          │     \   /     Sunny          │     \   /     Clear          │
#│      .-.      +29(30) °C     │      .-.      +32(33) °C     │      .-.      +28(29) °C     │      .-.      +25(27) °C     │
#│   ― (   ) ―   ↙ 10-18 km/h   │   ― (   ) ―   ↓ 17-31 km/h   │   ― (   ) ―   ↓ 13-19 km/h   │   ― (   ) ―   ↓ 6-11 km/h    │
#│      `-’      10 km          │      `-’      10 km          │      `-’      10 km          │      `-’      10 km          │
#│     /   \     0.0 mm | 0%    │     /   \     0.0 mm | 0%    │     /   \     0.0 mm | 0%    │     /   \     0.0 mm | 0%    │
#└──────────────────────────────┴──────────────────────────────┴──────────────────────────────┴──────────────────────────────┘



# 		From the text file parse todays temp values.

obs_t=$(grep -oP '[+-]?\d+\(\d+\)' weather_report.txt | awk 'NR==1')	# This command will list all the maches for the pattern +/-dd(dd) and pick the first.
echo "Todays temp is : $obs_t"

fc_t=$(grep -oP '[+-]?\d+\(\d+\)' weather_report.txt | awk 'NR==7')	# Here we pick the 7th, for tomorrow's noon.
echo "Tomorrows temp is : $fc_t"

#		Date

day=$(TZ=$tz date -u +%d)
month=$(TZ=$tz date +%m)
year=$(TZ=$tz date +%Y)
echo "date  $day $month $year"


#		Log data to the log
echo -e "$year\t$month\t$day\t$obs_t\t\t$fc_t C">>rx_poc.log
